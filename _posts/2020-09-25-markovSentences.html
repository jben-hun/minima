---
layout: post
title:  "Markov sentences"
categories: notebook
author:
- JBen
excerpt: Generate reddit comments with a markov chain
---

<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><a href="https://colab.research.google.com/github/jben-hun/colab_notebooks/blob/master/markovSentences.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Text-generation-with-nth-order-Markov-chain-models-trained-on-reddit-data">Text generation with nth order Markov chain models trained on reddit data<a class="anchor-link" href="#Text-generation-with-nth-order-Markov-chain-models-trained-on-reddit-data">&#182;</a></h1><p>The probability $P(\ word_{m}\ \mid\ word_{m-1}\ \land\ word_{m-2}\ \land\ \cdots\ \land\ word_{m-n}\ )$, where $n$ is the order of the model, is proportional to the relative occurrences of such sequence of words in the training dataset.</p>
<p>Example chain with a model of order $n=2$:</p>
<p>$\cdots\ word_{m-3}\ (word_{m-2}\ word_{m-1})\rightarrow(word_{m})\ word_{m+1}\ \cdots$</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Implementation">Implementation<a class="anchor-link" href="#Implementation">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>PRAW is used to interact with the reddit api, a reddit account and a registered app is required for usage, to get started:</p>
<ul>
<li><a href="https://praw.readthedocs.io/en/latest/getting_started/quick_start.html">https://praw.readthedocs.io/en/latest/getting_started/quick_start.html</a></li>
</ul>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install -q praw

<span class="kn">import</span> <span class="nn">praw</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;max_colwidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">client_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>
<span class="n">client_secret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>
<span class="n">user_agent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>

<span class="n">reddit</span> <span class="o">=</span> <span class="n">praw</span><span class="o">.</span><span class="n">Reddit</span><span class="p">(</span>
    <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
    <span class="n">user_agent</span><span class="o">=</span><span class="n">user_agent</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>     |████████████████████████████████| 153kB 2.7MB/s 
     |████████████████████████████████| 204kB 5.9MB/s 
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SUBREDDITS</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;askreddit&quot;</span><span class="p">,</span> <span class="s2">&quot;explainlikeimfive&quot;</span><span class="p">,</span> <span class="s2">&quot;dankmemes&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RedditMarkovChain</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">subreddit</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">sentence_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">begin_str</span><span class="o">=</span><span class="s2">&quot;*BEGIN*&quot;</span><span class="p">,</span>
            <span class="n">end_str</span><span class="o">=</span><span class="s2">&quot;*END*&quot;</span><span class="p">,</span>
            <span class="n">cycle_str</span><span class="o">=</span><span class="s2">&quot;*CYCLE*&quot;</span><span class="p">,</span>
            <span class="n">train_split</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">),</span>
            <span class="n">test_split</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__subreddit</span> <span class="o">=</span> <span class="n">subreddit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__order</span> <span class="o">=</span> <span class="n">order</span>
        <span class="c1"># first order: word1 -&gt; word2</span>
        <span class="c1"># second order: (word1, word2) -&gt; word3</span>
        <span class="c1"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sentence_limit</span> <span class="o">=</span> <span class="n">sentence_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__begin_str</span> <span class="o">=</span> <span class="n">begin_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__end_str</span> <span class="o">=</span> <span class="n">end_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cycle_str</span> <span class="o">=</span> <span class="n">cycle_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__train_split</span> <span class="o">=</span> <span class="n">train_split</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__test_split</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_split</span> <span class="k">if</span> <span class="n">test_split</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">train_split</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__sentences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mine_subreddit</span><span class="p">(</span>
            <span class="n">subreddit</span><span class="o">=</span><span class="n">reddit</span><span class="o">.</span><span class="n">subreddit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subreddit</span><span class="p">),</span>
            <span class="n">sentence_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sentence_limit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__build_model</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a markov chain model from extracted sentences&quot;&quot;&quot;</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_sentences</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">begin_str</span><span class="p">]</span> <span class="o">+</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">__split_sentence</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="o">+</span>
                     <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">end_str</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__convert_to_key</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">__convert_to_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pads with None values to until the length is equal to the order&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span> <span class="o">+</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_longest_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the longest subkey that exist in the model,</span>
<span class="sd">        or the full key if no subkey was found&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>

        <span class="c1"># if no existing key was found, return the full key, so the defaultdict</span>
        <span class="c1"># creates an entry for it with a count value of zero</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__split_sentence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split sentences into words&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;((?:[\w&#39;]+)|(?:[,!.?]))&quot;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get single probability from word counts&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">word</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__get_all_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all probabilities from word counts&quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="o">/</span><span class="n">n</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate text using the created markov chain model</span>

<span class="sd">        method:</span>
<span class="sd">            expected: choose most likely words, infinite cycles are possible</span>
<span class="sd">            random: choose words uniformly</span>
<span class="sd">            sample: choose words based on the modeled probabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sentence</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">begin_str</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__convert_to_key</span><span class="p">([</span><span class="n">word</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;expected&quot;</span><span class="p">:</span>
            <span class="n">used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;expected&quot;</span><span class="p">:</span>
                <span class="n">word</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;sample&quot;</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_all_probs</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_str</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">sentence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__convert_to_key</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:])</span>

            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;expected&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">used</span><span class="p">:</span>
                    <span class="n">sentence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; .&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; ?&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; !&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; ,&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deduce the most likely source of a sentence&quot;&quot;&quot;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">words</span> <span class="o">=</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">begin_str</span><span class="p">]</span> <span class="o">+</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">__split_sentence</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="o">+</span>
                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">end_str</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_longest_key</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__convert_to_key</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span><span class="n">i</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_prob</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">p</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">mine_subreddit</span><span class="p">(</span><span class="n">subreddit</span><span class="p">,</span> <span class="n">sentence_limit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract clean sentences from submissions and comments&quot;&quot;&quot;</span>

        <span class="c1"># re that matches clean sentences</span>
        <span class="n">matcher</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:[.!?] |^)[A-Z][\w&#39;, ]+[.!?](?= [A-Z]|$)&quot;</span><span class="p">)</span>

        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">sentence_limit</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">submission</span> <span class="ow">in</span> <span class="n">subreddit</span><span class="o">.</span><span class="n">hot</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">sentences</span> <span class="o">+=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                <span class="n">sentences</span> <span class="o">+=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">selftext</span><span class="p">)</span>

                <span class="n">submission</span><span class="o">.</span><span class="n">comment_sort</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span>

                <span class="n">comments</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">comment</span><span class="o">.</span><span class="n">body</span> <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">submission</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="n">praw</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">MoreComments</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">comments</span><span class="p">:</span>
                    <span class="n">sentences</span> <span class="o">+=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">sentence_limit</span><span class="p">:</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sentence_limit</span> <span class="o">-</span> <span class="n">pbar</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="o">-</span> <span class="n">pbar</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">sentence</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.!? &quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;won&#39;t&quot;</span><span class="p">,</span> <span class="s2">&quot;will not&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;n&#39;t&quot;</span><span class="p">,</span> <span class="s2">&quot; not&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;m&quot;</span><span class="p">,</span> <span class="s2">&quot; am&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot; are&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">[:</span><span class="n">sentence_limit</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subreddit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subreddit</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sentences</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__order</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sentence_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sentence_limit</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">begin_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__begin_str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">end_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end_str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cycle_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cycle_str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">train_split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__train_split</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">test_split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test_split</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">train_sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">test_sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">):]</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Demo">Demo<a class="anchor-link" href="#Demo">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><strong>Construct markov chains for each specified subreddit</strong></p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chains</span> <span class="o">=</span> <span class="p">{</span><span class="n">subreddit</span><span class="p">:</span> <span class="n">RedditMarkovChain</span><span class="p">(</span><span class="n">subreddit</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sentence_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">subreddit</span> <span class="ow">in</span> <span class="n">SUBREDDITS</span><span class="p">}</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr">
<pre>100%|██████████| 1000/1000 [00:14&lt;00:00, 68.29it/s]
100%|██████████| 1000/1000 [00:14&lt;00:00, 67.01it/s]
100%|██████████| 1000/1000 [00:37&lt;00:00, 26.85it/s]
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><strong>Deriving most probable sentence for each model</strong></p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">subreddit</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subreddit</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="s1">&#39;expected&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>askreddit: I was at a young age.
explainlikeimfive: The problem with strictly widening a base, while maintaining perpendicular wheels, is there really any point?
dankmemes: I am not a arest&#39; of the movie.
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><strong>Generating new text</strong></p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>

<span class="k">for</span> <span class="n">subreddit</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
        <span class="n">dict_data</span><span class="p">[</span><span class="s2">&quot;sentence&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="n">dict_data</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subreddit</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
            <span class="n">dict_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_data</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sentence</th>
      <th>model</th>
      <th>P(askreddit)</th>
      <th>P(explainlikeimfive)</th>
      <th>P(dankmemes)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>And it was great to see us do better in the neck.</td>
      <td>askreddit</td>
      <td>3.283425e-07</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Yep.</td>
      <td>askreddit</td>
      <td>3.333333e-03</td>
      <td>0.000000e+00</td>
      <td>0.002222</td>
    </tr>
    <tr>
      <th>2</th>
      <td>They have the Democrats would control the Senate, and it would cost the city less money to simply buy Norman and his mum a house far far away than to keep his mouth shut about the actual state of being in love.</td>
      <td>askreddit</td>
      <td>6.977041e-11</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mitch's interests are focused on my own spit I want that put in my own car.</td>
      <td>askreddit</td>
      <td>1.102293e-06</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Congrats, onward with your journey.</td>
      <td>askreddit</td>
      <td>5.555556e-04</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>A great example of this lap the runners will be separated by the stagger so there are parts of the lower body are some of these things.</td>
      <td>explainlikeimfive</td>
      <td>0.000000e+00</td>
      <td>7.419278e-10</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Thanks for powerfully refuting your own horrible idea.</td>
      <td>explainlikeimfive</td>
      <td>0.000000e+00</td>
      <td>1.111111e-03</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>The answer is not really explain it well, but also a matter of how anything floats is that you can try this easily.</td>
      <td>explainlikeimfive</td>
      <td>0.000000e+00</td>
      <td>1.627817e-11</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PC games are made to run properly on your system, kidneys and digestion.</td>
      <td>explainlikeimfive</td>
      <td>0.000000e+00</td>
      <td>2.314815e-05</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Enough slack that it will interfere with the clock and yourself.</td>
      <td>explainlikeimfive</td>
      <td>0.000000e+00</td>
      <td>1.736111e-06</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Im a minor and seeing those girls in those provocative positions and clothing isnt ok.</td>
      <td>dankmemes</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.001111</td>
    </tr>
    <tr>
      <th>11</th>
      <td>What I said, with utter confidence, that it'd become a square.</td>
      <td>dankmemes</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000139</td>
    </tr>
    <tr>
      <th>12</th>
      <td>How.</td>
      <td>dankmemes</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.001111</td>
    </tr>
    <tr>
      <th>13</th>
      <td>The cum accelerates.</td>
      <td>dankmemes</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.005556</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Well played.</td>
      <td>dankmemes</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.001111</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><strong>Classifying real text</strong></p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Classifying isn't exactly ideal this way, as probabilities turn zero when an unprecedented word connection is met. Check out multinomial naive Bayes for a simple text classifier.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>

<span class="k">for</span> <span class="n">subreddit</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">test_sentences</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">dict_data</span><span class="p">[</span><span class="s2">&quot;sentence&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="n">dict_data</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subreddit</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
            <span class="n">dict_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_data</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sentence</th>
      <th>source</th>
      <th>P(askreddit)</th>
      <th>P(explainlikeimfive)</th>
      <th>P(dankmemes)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sixth grade end of year trip, we were at a ropes course park where you'd rock climb and walked across tall catwalks and the like.</td>
      <td>askreddit</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Our reality is a fiction created by a higher civilization of higher beings who wrote a story and transformed it into a reality and every move, breath, even blink, is already programmed.</td>
      <td>askreddit</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mitch is really old.</td>
      <td>askreddit</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Choking to death alone is honestly my biggest fear.</td>
      <td>askreddit</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>The logic was similar for us, yes.</td>
      <td>askreddit</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>On my PC, just the BIOS takes longer than that.</td>
      <td>explainlikeimfive</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>No, only 4 left and 5 right.</td>
      <td>explainlikeimfive</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>HAHA.</td>
      <td>explainlikeimfive</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Why is it that being slapped in the face will make you cry, stubing your toe makes you inhale rendering you speechless and being burnt by hot water will make you growl or scream?</td>
      <td>explainlikeimfive</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Kernel API is for abstracting away the nasty parts of communicating with the operating system.</td>
      <td>explainlikeimfive</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>My pain is far greater than yours!</td>
      <td>dankmemes</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Really?</td>
      <td>dankmemes</td>
      <td>0.001111</td>
      <td>0.0</td>
      <td>0.002222</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Weird flex warning!</td>
      <td>dankmemes</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Is this 1984?</td>
      <td>dankmemes</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>After ten spurts you start to worry.</td>
      <td>dankmemes</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="References">References<a class="anchor-link" href="#References">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<ul>
<li><a href="https://en.wikipedia.org/wiki/Markov_chain">https://en.wikipedia.org/wiki/Markov_chain</a></li>
<li><a href="https://www.reddit.com/r/SubredditSimulator/comments/3g9ioz/what_is_rsubredditsimulator/">https://www.reddit.com/r/SubredditSimulator/comments/3g9ioz/what_is_rsubredditsimulator/</a></li>
<li><a href="https://www.reddit.com/r/SubSimulatorGPT2/comments/btfhks/what_is_rsubsimulatorgpt2/">https://www.reddit.com/r/SubSimulatorGPT2/comments/btfhks/what_is_rsubsimulatorgpt2/</a></li>
</ul>

</div>
</div>
